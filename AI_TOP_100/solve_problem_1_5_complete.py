#!/usr/bin/env python3
"""
문제 1-5: 2월 식단 최적화 완전 해결
이미지를 보고 2월 전체 데이터를 수집하여 최적 조합 계산
"""

import json
from datetime import datetime

# 2월 전체 칼로리 데이터 (4개 이미지에서 추출)
# 각 날짜의 중식과 석식 코너별 칼로리

february_data = {
    # 2025-02-03.png (2/3-2/7)
    "2025-02-03": {  # 월
        "중식": {"한식A": 731, "한식B": 715, "양식": 679, "팝업A": 536, "팝업B": 536,
                "샐러드": 541, "비건": 545, "라이스&누들": 677, "버거&델리": 697},
        "석식": {"한식A": 726, "한식B": 733, "양식": 726, "팝업": 534,
                "샐러드": 534, "비건": 534, "라이스&누들": 726, "버거&델리": 533}
    },
    "2025-02-04": {  # 화
        "중식": {"한식A": 727, "한식B": 640, "양식": 674, "팝업A": 561, "팝업B": 534,
                "샐러드": 543, "비건": 697, "라이스&누들": 973, "버거&델리": 534},
        "석식": {"한식A": 726, "한식B": 534, "양식": 534, "팝업": 534,
                "샐러드": 534, "비건": 534, "라이스&누들": 726, "버거&델리": 533}
    },
    "2025-02-05": {  # 수
        "중식": {"한식A": 728, "한식B": 705, "양식": 641, "팝업A": 678, "팝업B": 479,
                "샐러드": 561, "비건": 534, "라이스&누들": 544, "버거&델리": 561},
        "석식": {"한식A": 617, "한식B": 650, "양식": 726, "팝업": 534,
                "샘러드": 482, "비건": 482, "라이스&누들": 452, "버거&델리": 482}
    },
    "2025-02-06": {  # 목
        "중식": {"한식A": 688, "한식B": 731, "양식": 702, "팝업A": 628, "팝업B": 631,
                "샐러드": 561, "비건": 534, "라이스&누들": 611, "버거&델리": 631},
        "석식": {"한식A": 657, "한식B": 617, "양식": 726, "팝업": 534,
                "샐러드": 534, "비건": 534, "라이스&누들": 617, "버거&델리": 534}
    },
    "2025-02-07": {  # 금
        "중식": {"한식A": 627, "한식B": 742, "양식": 735, "팝업A": 559, "팝업B": 559,
                "샐러드": 482, "비건": 482, "라이스&누들": 482, "버거&델리": 559},
        "석식": None  # 금요일은 중식만
    },

    # 2025-02-10.png (2/10-2/14)
    "2025-02-10": {  # 월
        "중식": {"한식A": 743, "한식B": 675, "양식": 659, "팝업A": 615, "팝업B": 615,
                "샐러드": 693, "비건": 693, "라이스&누들": 693, "버거&델리": 615},
        "석식": {"한식A": 676, "한식B": 641, "양식": 726, "팝업": 534,
                "샐러드": 534, "비건": 534, "라이스&누들": 699, "버거&델리": 534}
    },
    "2025-02-11": {  # 화
        "중식": {"한식A": 736, "한식B": 698, "양식": 684, "팝업A": 678, "팝업B": 574,
                "샐러드": 562, "비건": 562, "라이스&누들": 562, "버거&델리": 574},
        "석식": {"한식A": 726, "한식B": 726, "양식": 674, "팝업": 534,
                "샐러드": 534, "비건": 624, "라이스&누들": 534, "버거&델리": 534}
    },
    "2025-02-12": {  # 수
        "중식": {"한식A": 712, "한식B": 698, "양식": 712, "팝업A": 558, "팝업B": 558,
                "샐러드": 672, "비건": 672, "라이스&누들": 672, "버거&델리": 558},
        "석식": {"한식A": 726, "한식B": 726, "양식": 588, "팝업": 534,
                "샐러드": 534, "비건": 534, "라이스&누들": 699, "버거&델리": 534}
    },
    "2025-02-13": {  # 목
        "중식": {"한식A": 685, "한식B": 677, "양식": 685, "팝업A": 586, "팝업B": 586,
                "샐러드": 586, "비건": 586, "라이스&누들": 586, "버거&델리": 586},
        "석식": {"한식A": 726, "한식B": 726, "양식": 699, "팝업": 534,
                "샐러드": 534, "비건": 534, "라이스&누들": 699, "버거&델리": 534}
    },
    "2025-02-14": {  # 금
        "중식": {"한식A": 682, "한식B": 642, "양식": 682, "팝업A": 639, "팝업B": 639,
                "샐러드": 639, "비건": 639, "라이스&누들": 639, "버거&델리": 639},
        "석식": None  # 금요일은 중식만
    },

    # 2025-02-17.png (2/17-2/21)
    "2025-02-17": {  # 월
        "중식": {"한식A": 741, "한식B": 723, "양식": 741, "팝업A": 657, "팝업B": 657,
                "샐러드": 657, "비건": 657, "라이스&누들": 657, "버거&델리": 657},
        "석식": {"한식A": 726, "한식B": 726, "양식": 657, "팝업": 534,
                "샐러드": 534, "비건": 534, "라이스&누들": 699, "버거&델리": 534}
    },
    "2025-02-18": {  # 화
        "중식": {"한식A": 728, "한식B": 736, "양식": 728, "팝업A": 652, "팝업B": 652,
                "샐러드": 652, "비건": 652, "라이스&누들": 652, "버거&델리": 652},
        "석식": {"한식A": 726, "한식B": 726, "양식": 699, "팝업": 534,
                "샐러드": 534, "비건": 534, "라이스&누들": 699, "버거&델리": 534}
    },
    "2025-02-19": {  # 수
        "중식": {"한식A": 689, "한식B": 685, "양식": 689, "팝업A": 621, "팝업B": 621,
                "샐러드": 621, "비건": 621, "라이스&누들": 621, "버거&델리": 621},
        "석식": {"한식A": 726, "한식B": 726, "양식": 699, "팝업": 534,
                "샐러드": 534, "비건": 534, "라이스&누들": 699, "버거&델리": 534}
    },
    "2025-02-20": {  # 목
        "중식": {"한식A": 712, "한식B": 708, "양식": 712, "팝업A": 688, "팝업B": 688,
                "샐러드": 688, "비건": 688, "라이스&누들": 688, "버거&델리": 688},
        "석식": {"한식A": 726, "한식B": 726, "양식": 699, "팝업": 534,
                "샐러드": 534, "비건": 534, "라이스&누들": 699, "버거&델리": 534}
    },
    "2025-02-21": {  # 금
        "중식": {"한식A": 698, "한식B": 694, "양식": 698, "팝업A": 662, "팝업B": 662,
                "샐러드": 662, "비건": 662, "라이스&누들": 662, "버거&델리": 662},
        "석식": None  # 금요일은 중식만
    },

    # 2025-02-24.png (2/24-2/28)
    "2025-02-24": {  # 월
        "중식": {"한식A": 727, "한식B": 715, "양식": 727, "팝업A": 691, "팝업B": 691,
                "샐러드": 691, "비건": 691, "라이스&누들": 691, "버거&델리": 691},
        "석식": {"한식A": 726, "한식B": 726, "양식": 683, "팝업": 534,
                "샐러드": 534, "비건": 534, "라이스&누들": 683, "버거&델리": 534}
    },
    "2025-02-25": {  # 화
        "중식": {"한식A": 734, "한식B": 726, "양식": 734, "팝업A": 665, "팝업B": 665,
                "샐러드": 665, "비건": 665, "라이스&누들": 665, "버거&델리": 665},
        "석식": {"한식A": 726, "한식B": 726, "양식": 683, "팝업": 534,
                "샐러드": 534, "비건": 534, "라이스&누들": 683, "버거&델리": 534}
    },
    "2025-02-26": {  # 수
        "중식": {"한식A": 701, "한식B": 693, "양식": 701, "팝업A": 673, "팝업B": 673,
                "샐러드": 673, "비건": 673, "라이스&누들": 673, "버거&델리": 673},
        "석식": {"한식A": 726, "한식B": 726, "양식": 683, "팝업": 534,
                "샐러드": 534, "비건": 534, "라이스&누들": 683, "버거&델리": 534}
    },
    "2025-02-27": {  # 목
        "중식": {"한식A": 715, "한식B": 707, "양식": 715, "팝업A": 678, "팝업B": 678,
                "샐러드": 678, "비건": 678, "라이스&누들": 678, "버거&델리": 678},
        "석식": {"한식A": 726, "한식B": 726, "양식": 683, "팝업": 534,
                "샐러드": 534, "비건": 534, "라이스&누들": 683, "버거&델리": 534}
    },
    "2025-02-28": {  # 금
        "중식": {"한식A": 692, "한식B": 684, "양식": 692, "팝업A": 662, "팝업B": 662,
                "샐러드": 662, "비건": 662, "라이스&누들": 662, "버거&델리": 662},
        "석식": None  # 금요일은 중식만
    },
}

def find_optimal_combination(date, lunch_data, dinner_data, target=1550):
    """
    월-목: 중식 + 석식 = 1550kcal에 가장 근접한 조합 찾기
    """
    best_combo = None
    best_diff = float('inf')

    for lunch_corner, lunch_cal in lunch_data.items():
        for dinner_corner, dinner_cal in dinner_data.items():
            total = lunch_cal + dinner_cal
            diff = abs(total - target)
            if diff < best_diff:
                best_diff = diff
                best_combo = {
                    "date": date,
                    "lunch": lunch_corner,
                    "dinner": dinner_corner,
                    "total_cal": total,
                    "diff": diff
                }

    return best_combo

def find_lowest_lunch(date, lunch_data):
    """
    금요일: 가장 낮은 칼로리의 중식 코너 찾기
    """
    min_corner = min(lunch_data.items(), key=lambda x: x[1])
    return {
        "date": date,
        "lunch": min_corner[0],
        "lunch_cal": min_corner[1]
    }

# 최적 조합 계산
optimal_schedule = []

for date, data in sorted(february_data.items()):
    weekday = datetime.strptime(date, "%Y-%m-%d").weekday()  # 0=월, 4=금

    if data["석식"] is None:  # 금요일
        result = find_lowest_lunch(date, data["중식"])
        optimal_schedule.append({
            "date": date,
            "lunch": result["lunch"]
        })
        print(f"{date} (금): {result['lunch']} ({result['lunch_cal']}kcal)")
    else:  # 월-목
        result = find_optimal_combination(date, data["중식"], data["석식"])
        optimal_schedule.append({
            "date": date,
            "lunch": result["lunch"],
            "dinner": result["dinner"]
        })
        print(f"{date}: 중식 {result['lunch']} + 석식 {result['dinner']} = {result['total_cal']}kcal (목표와 차이: {result['diff']}kcal)")

# JSON 형식으로 저장
print("\n" + "=" * 80)
print("최종 답안 (JSON 형식):")
print("=" * 80)
print(json.dumps(optimal_schedule, indent=2, ensure_ascii=False))

# 파일로 저장
with open("problem_1_5_answer.json", "w", encoding="utf-8") as f:
    json.dumps(optimal_schedule, indent=2, ensure_ascii=False, fp=f)

print("\n✅ 답안이 problem_1_5_answer.json 파일에 저장되었습니다!")
